---
layout: post
title: 行情系统笔记
date: 2020-6-4
categories: work
tags: 
  - 运维
  - 金融
---

### 单营业部拓扑图及数据流

![](http://m.qpic.cn/psc?/V148DVWB3fRuPX/.2zjIxUMH7Q2WFRfFWg99MahghXmKKvBwc60q9u7duGpUa1VUnNvJhUeGyPDdhKL19SvvMFFmowwzBSsDH.HlA!!/b&bo=eQEDAgAAAAADB1s!&rf=viewer_4)

- 行情发送读取交易所行情库数据，进行转码，通过网络链路发送到行情接收；

- 行情接收收到数据后，保存到内存盘中，每日闭市后对全天的数据进行收盘，产生历史数据，并生成下载数据；

- 行情主站根据客户端的不同请求读取内存盘中的当日分时数据，或者读取历史数据。

### 行情发送的功能

- 转换外部基本行情数据为内部数据结构，如最新价、最高最低价、成交量、买卖盘等。

- 转换扩展数据为内部数据结构，如券商席位信息。

- 实现一些统计计算功能，如统计股票个数、总成交量、加权平均价格等。

- 将转换后的数据经压缩、加密处理传给行情接收端。

### 行情发送的文件组成

**VC运行动态库** 。

**HxSend.exe**

- 行情发送主程序

- 新版本股票行情发送程序为：shsz.exe

**HxSend.ini**

- 行情发送配置文件(注意：配置文件是在当前目录下,跟主文件同名)。

**Tcp.dll**

- TCP 协议通讯动态库。

**Comdlv.dll**

- 并口协议通讯动态库。

### 行情接收的功能

- 接收各行情接口发送过来的行情数据包，并转码，生成分时走势图、行情明细表、日K线，分钟K线、月K线等 。

- 接收资讯接口发送过来的资讯数据 。

- 接收到的数据与行情主站共享 。

- 行情接收间根据行情源类别实现互为备份，可自动判断异常情况，如开盘前未初始化、开市期间未收到行情数据。行情接收不能获得数据时，可从其他的行情接收处备份到实时数据。作为备份的行情接收必须是互相信任的 。

- 将行情数据状况提供给监控接口，使维护人员迅速响应故障。

### 行情接收的文件组成

**VC运行动态库** 。

**HxRece.exe**

- 行情接收主程序

**HxRece.ini**

- 行情接收配置文件(注意：配置文件是在当前目录下,跟主文件同名)。

**Tcp.dll**

- TCP 协议通讯动态库。

### 行情主站的功能

- 验证用户身份：接收用户端提交的通行证，校验通行证签名是否合法有效，根据通行证内容确认用户权限、服务内容，判断是否可以使用Level-2实时行情信息

- 响应用户端请求：对于合法请求提供相应内容。根据用户权限的不同，行情服务可提供给用户中不同类别的内容。提供的数据内容可按金融市场（上海证券、深圳证券、期货市场等）、数据级别（基本行情、Level-2行情）、数据类别（实时行情数据、历史行情数据、财务数据）加以区分 。

- 统计用户信息、在线人数，并提供给监控接口，以便后台掌握实时用户数据。根据服务器的资源消耗、在线人数等，在用户端实现智能切换，保证用户连接到最畅通的通道 。

- 支持线性扩充，结合均衡负载功能，提供更强大的服务能力 。

### 行情主站的文件组成

**VC运行动态库** 。

**Hxhq.exe**

- 行情接收主程序

**Hxhq.ini**

- 行情接收配置文件(注意：配置文件是在当前目录下,跟主文件同名)。

**Tcp.dll**

- TCP 协议通讯动态库。

**Usersdb.dll**

- Usersdb行情用户管理程序(与4.xx版行情系统所用的版本相同) 。

**其它辅助文件**